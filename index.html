<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¯ä»¥åšæˆ‘çš„å°ç‹—å—</title>

    <!-- æ·»åŠ PWAæ”¯æŒ -->
    <meta name="theme-color" content="#ff6b9d">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="icon-192x192.png">


    <style>
        /* åŸºç¡€æ ·å¼ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Courier New', monospace;
            image-rendering: pixelated;
        }
        
        body {
            background: linear-gradient(135deg, #ffcce6, #ccf2ff, #fff0cc, #e6ccff);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
            min-height: 100vh;
            padding: 20px;
            color: #5a4a6a;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        h1 {
            font-size: 2.5rem;
            color: #ff6b9d;
            text-shadow: 3px 3px 0 #ffd166;
            margin-bottom: 10px;
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #5a4a6a;
        }
        
        /* ä¸»å†…å®¹åŒºåŸŸ */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        /* å¡ç‰‡æ ·å¼ */
        .card {
            background: rgba(255, 255, 255, 0.85);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 4px solid;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h2 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #ff6b9d;
            display: flex;
            align-items: center;
        }
        
        .card h2 i {
            margin-right: 10px;
        }
        
        /* å°ç‹—åŒºåŸŸ */
        .dog-area {
            grid-column: 1 / -1;
            text-align: center;
            border-color: #ff9a9e;
        }
        
        .pixel-dog {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            position: relative;
            background: #ffd166;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .dog-ear {
            position: absolute;
            width: 40px;
            height: 60px;
            background: #ffb347;
            border-radius: 50%;
            top: -20px;
        }
        
        .dog-ear.left {
            left: 20px;
            transform: rotate(-30deg);
        }
        
        .dog-ear.right {
            right: 20px;
            transform: rotate(30deg);
        }
        
        .dog-face {
            width: 100px;
            height: 100px;
            background: #ffd166;
            border-radius: 50%;
            position: relative;
            z-index: 2;
        }
        
        .dog-eye {
            position: absolute;
            width: 15px;
            height: 20px;
            background: #5a4a6a;
            border-radius: 50%;
            top: 30px;
        }
        
        .dog-eye.left {
            left: 25px;
        }
        
        .dog-eye.right {
            right: 25px;
        }
        
        .dog-nose {
            position: absolute;
            width: 20px;
            height: 15px;
            background: #ff6b9d;
            border-radius: 50%;
            bottom: 30px;
            left: 40px;
        }
        
        .dog-status {
            margin-top: 15px;
            font-size: 1.1rem;
        }
        
        /* äº’åŠ¨æŒ‰é’® */
        .interaction-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        button {
            background: #ff9a9e;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        button:hover {
            background: #ff6b9d;
            transform: scale(1.05);
        }
        
        /* å–‚é£Ÿå¡ç‰‡ */
        .feeding-card {
            border-color: #a1de93;
        }
        
        .food-items {
            display: flex;
            justify-content: space-around;
            margin: 15px 0;
        }
        
        .food-item {
            width: 60px;
            height: 60px;
            background: #ffd166;
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.5rem;
        }
        
        .food-item:hover {
            transform: scale(1.1);
        }
        
        /* æ¸¸æˆå¡ç‰‡ */
        .game-card {
            border-color: #74b9ff;
        }
        
        .game-area {
            background: #e6f2ff;
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
            min-height: 150px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        /* æ—¥è®°å¡ç‰‡ */
        .diary-card {
            border-color: #e6ccff;
        }
        
        textarea {
            width: 100%;
            height: 120px;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #e6ccff;
            resize: none;
            margin-bottom: 10px;
            font-size: 1rem;
        }
        
        /* å¤©æ°”å¡ç‰‡ */
        .weather-card {
            border-color: #ffd166;
        }
        
        .weather-info {
            display: flex;
            align-items: center;
            justify-content: space-around;
            margin-top: 10px;
        }
        
        .weather-icon {
            font-size: 3rem;
        }
        
        .weather-details {
            text-align: left;
        }
        
        /* æ¶ˆæ¯åŒºåŸŸ */
        .message-area {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            border-left: 5px solid #ff6b9d;
        }
        
        /* åƒç´ é£è£…é¥° */
        .pixel-border {
            border: 4px solid;
            border-image: repeating-linear-gradient(45deg, #ff6b9d, #ff6b9d 10px, #ffd166 10px, #ffd166 20px) 10;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            padding: 15px;
            color: #5a4a6a;
            font-size: 0.9rem;
        }
        
        /* å®è—å¡æ ·å¼ */
        .treasure-card {
            border-color: #ffd700;
            position: relative;
            overflow: hidden;
        }
        
        .treasure-card::before {
            content: 'âœ¨';
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5rem;
            animation: sparkle 2s infinite;
        }
        
        @keyframes sparkle {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }
        
        .dog-info-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .info-item {
            background: rgba(255, 215, 0, 0.1);
            padding: 12px;
            border-radius: 10px;
            border-left: 4px solid #ffd700;
        }
        
        .info-item label {
            font-weight: bold;
            color: #ff6b9d;
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .info-item .value {
            color: #5a4a6a;
            font-size: 1rem;
        }
        
        .mood-diary {
            margin-top: 15px;
            background: rgba(255, 215, 0, 0.05);
            padding: 15px;
            border-radius: 10px;
            border: 2px dashed #ffd700;
        }
        
        .mood-diary h3 {
            color: #ff6b9d;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .diary-entry {
            background: white;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 3px solid #ffd700;
        }
        
        .diary-date {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 5px;
        }
        
        .diary-content {
            color: #5a4a6a;
            font-size: 0.9rem;
        }
        
        /* é€‰æ‹©æŒ‰é’®æ ·å¼ */
        .choice-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }
        
        .choice-btn {
            background: #ff6b9d;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s;
            border: 3px solid transparent;
        }
        
        .choice-btn:hover {
            background: #ff4d8a;
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(255, 107, 157, 0.4);
        }
        
        #yes-btn {
            background: #06d6a0;
        }
        
        #yes-btn:hover {
            background: #04b885;
            box-shadow: 0 5px 15px rgba(6, 214, 160, 0.4);
        }
        
        /* å¯¹è¯æ¡†æ ·å¼ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            border: 5px solid #ff6b9d;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .modal-content h3 {
            color: #ff6b9d;
            font-size: 1.5rem;
            margin-bottom: 20px;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        /* æ–°å¢ä¼˜åŒ–æ ·å¼ */
        .interaction-feedback {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 107, 157, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 1.2rem;
            z-index: 10001;
            animation: popIn 0.5s ease-out;
            display: none;
        }
        
        @keyframes popIn {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            70% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b9d, #ffd166);
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .achievement-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 215, 0, 0.95);
            padding: 15px;
            border-radius: 10px;
            border: 3px solid #ff6b9d;
            z-index: 10000;
            animation: slideInRight 0.5s ease-out;
            display: none;
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .floating-hearts {
            position: fixed;
            pointer-events: none;
            z-index: 9998;
        }
        
        .heart {
            position: absolute;
            font-size: 20px;
            animation: floatUp 2s ease-out forwards;
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-100px) scale(0.5); opacity: 0; }
        }
        
        .pulse {
            animation: pulse 0.5s ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        
        .bounce {
            animation: bounce 0.6s ease;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-10px);}
            60% {transform: translateY(-5px);}
        }
        
        .shake {
            animation: shake 0.5s ease;
        }
        
        @keyframes shake {
            0%, 100% {transform: translateX(0);}
            25% {transform: translateX(-5px);}
            75% {transform: translateX(5px);}
        }
        
        /* æ–°å¢ç›¸å†Œå¡ç‰‡æ ·å¼ */
        .photo-album {
            border-color: #a1c4fd;
            grid-column: 1 / -1;
        }
        
        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .photo-item {
            width: 100%;
            aspect-ratio: 1;
            background: #f5f5f5;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            overflow: hidden;
            position: relative;
        }
        
        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .photo-item::after {
            content: '+';
            position: absolute;
            font-size: 2rem;
            color: #ff6b9d;
        }
        
        .photo-item.has-image::after {
            display: none;
        }
        
        /* æ–°å¢æˆå°±ç³»ç»Ÿæ ·å¼ */
        .achievement-card {
            border-color: #ffd166;
        }
        
        .badge-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .badge {
            width: 60px;
            height: 60px;
            background: #ff9a9e;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
        }
        
        .badge.locked {
            filter: grayscale(80%);
            opacity: 0.6;
        }
        
        .badge i {
            font-size: 1.8rem;
        }
        
        .badge-tooltip {
            position: absolute;
            bottom: -30px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            white-space: nowrap;
            display: none;
        }
        
        .badge:hover .badge-tooltip {
            display: block;
        }
        
        /* æ–°å¢éŸ³ä¹æ’­æ”¾å™¨æ ·å¼ */
        .music-player {
            border-color: #e6ccff;
        }
        
        .player-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-top: 15px;
        }
        
        .play-btn {
            width: 50px;
            height: 50px;
            background: #ff6b9d;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
        }
        
        .play-btn i {
            font-size: 1.5rem;
            color: white;
        }
        
        .song-info {
            margin-top: 10px;
            text-align: center;
        }
        
        /* æ–°å¢è¯­éŸ³æ¶ˆæ¯æ ·å¼ */
        .voice-message {
            border-color: #74b9ff;
        }
        
        .voice-btn {
            width: 60px;
            height: 60px;
            background: #06d6a0;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto;
            cursor: pointer;
            animation: pulse 2s infinite;
        }
        
        .voice-btn i {
            font-size: 1.8rem;
            color: white;
        }
        
        .voice-message-text {
            margin-top: 10px;
            text-align: center;
            min-height: 50px;
        }
        
        /* ä»»åŠ¡ç³»ç»Ÿæ ·å¼ */
        .task-card {
            border-color: #a1de93;
        }
        
        .task-item {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        
        .task-checkbox {
            margin-right: 10px;
        }
        
        .task-progress {
            width: 100%;
            height: 8px;
            background: #f0f0f0;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        .task-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b9d, #ffd166);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* æ·»åŠ ç§»åŠ¨ç«¯æ ·å¼ä¼˜åŒ– */
         /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 600px) {
            .card {
                padding: 15px;
            }
            
            button {
                padding: 12px;
                font-size: 1rem;
            }
            
            .interaction-buttons {
                flex-direction: column;
                gap: 8px;
            }
            
            .food-items {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* é˜²æ­¢ç§»åŠ¨ç«¯ç‚¹å‡»å»¶è¿Ÿ */
        * {
            touch-action: manipulation;
        }
        
        /* å…¨å±åº”ç”¨æ ·å¼ */
        body {
            -webkit-overflow-scrolling: touch;
            overscroll-behavior-y: contain;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>å¯ä»¥åšæˆ‘çš„å°ç‹—å—ï¼Ÿ ğŸ•</h1>
            <p class="subtitle">è¯·é€‰æ‹©ä½ çš„ç­”æ¡ˆ</p>
            <div class="choice-buttons">
                <button id="yes-btn" class="choice-btn">YES</button>
                <button id="no-btn" class="choice-btn">NO</button>
            </div>
        </header>
        
        <div class="main-content">
            <!-- å°ç‹—åŒºåŸŸ -->
            <div class="card dog-area">
                <div class="pixel-dog">
                    <div class="dog-ear left"></div>
                    <div class="dog-ear right"></div>
                    <div class="dog-face">
                        <div class="dog-eye left"></div>
                        <div class="dog-eye right"></div>
                        <div class="dog-nose"></div>
                    </div>
                </div>
                <div class="dog-status">
                    <p>å¿ƒæƒ…: <span id="mood">å¼€å¿ƒ ğŸ˜Š</span> | é¥±è…¹åº¦: <span id="hunger">80%</span></p>
                </div>
                <div class="interaction-buttons">
                    <button id="pet-btn">æ‘¸æ‘¸å°ç‹— ğŸ¾</button>
                    <button id="walk-btn">å¸¦å°ç‹—æ•£æ­¥ ğŸš¶â€â™‚ï¸</button>
                    <button id="play-btn">å’Œå°ç‹—ç©è€ ğŸ¾</button>
                </div>
            </div>
            
            <!-- å–‚é£Ÿå¡ç‰‡ -->
            <div class="card feeding-card">
                <h2><i>ğŸ–</i> å–‚é£Ÿå°ç‹—</h2>
                <p>é€‰æ‹©é£Ÿç‰©å–‚ç»™ä½ çš„å°ç‹—ï¼š</p>
                <div class="food-items">
                    <div class="food-item" data-food="bone">ğŸ¦´</div>
                    <div class="food-item" data-food="meat">ğŸ–</div>
                    <div class="food-item" data-food="fish">ğŸŸ</div>
                    <div class="food-item" data-food="carrot">ğŸ¥•</div>
                </div>
                <p id="feeding-message">å°ç‹—æ­£åœ¨ç­‰å¾…ç¾é£Ÿ...</p>
            </div>
            
            <!-- æ¸¸æˆå¡ç‰‡ -->
            <div class="card game-card">
                <h2><i>ğŸ®</i> å°æ¸¸æˆ</h2>
                <p>å’Œå°ç‹—ä¸€èµ·ç©æ¥çƒæ¸¸æˆï¼</p>
                <div class="game-area">
                    <p id="game-instruction">ç‚¹å‡»å¼€å§‹æŒ‰é’®ï¼Œçœ‹çœ‹å°ç‹—èƒ½æ¥ä½å¤šå°‘çƒï¼</p>
                    <button id="start-game">å¼€å§‹æ¸¸æˆ</button>
                    <div id="game-stats" style="display: none; margin-top: 10px;">
                        <p>æ¥ä½: <span id="score">0</span> çƒ</p>
                        <p>æ—¶é—´: <span id="time">30</span> ç§’</p>
                    </div>
                </div>
            </div>
            
            <!-- æ—¥è®°å¡ç‰‡ -->
            <div class="card diary-card">
                <h2><i>ğŸ“”</i> å…±äº«æ—¥è®°</h2>
                <p>è®°å½•ä½ å’Œå°ç‹—çš„æ—¥å¸¸ï¼š</p>
                <textarea id="diary-entry" placeholder="ä»Šå¤©å’Œå°ç‹—ä¸€èµ·..."></textarea>
                <button id="save-diary">ä¿å­˜æ—¥è®°</button>
                <div id="diary-history">
                    <p>ä¹‹å‰çš„æ—¥è®°ä¼šæ˜¾ç¤ºåœ¨è¿™é‡Œ...</p>
                </div>
            </div>
            
            <!-- å¤©æ°”å¡ç‰‡ -->
            <div class="card weather-card">
                <h2><i>ğŸŒ¤ï¸</i> å°çªå¤©æ°”</h2>
                <div class="weather-info">
                    <div class="weather-icon">â˜€ï¸</div>
                    <div class="weather-details">
                        <p>æ¸©åº¦: <span id="temperature">24Â°C</span></p>
                        <p>å¤©æ°”: <span id="weather-condition">æ™´æœ—</span></p>
                        <p>å¿ƒæƒ…æŒ‡æ•°: <span id="mood-index">95/100</span></p>
                    </div>
                </div>
                <button id="update-weather" style="margin-top: 10px;">æ›´æ–°å¤©æ°”</button>
            </div>
            
            <!-- å°ç‹—çš„å®è—å¡ -->
            <div class="card treasure-card">
                <h2><i>ğŸ•</i> å°ç‹—çš„å®è—å¡</h2>
                <div class="dog-info-grid">
                    <div class="info-item">
                        <label>å°ç‹—åå­—</label>
                        <div class="value" id="dog-name">å°å¯çˆ±</div>
                    </div>
                    <div class="info-item">
                        <label>æ’’å¨‡ç§°å·</label>
                        <div class="value" id="dog-nickname">æ’’å¨‡å°èƒ½æ‰‹</div>
                    </div>
                    <div class="info-item">
                        <label>æœ€å–œæ¬¢çš„äºº</label>
                        <div class="value" id="favorite-person">ä½ </div>
                    </div>
                    <div class="info-item">
                        <label>ä»Šæ—¥å¿ƒæƒ…</label>
                        <div class="value" id="today-mood">è¶…çº§å¼€å¿ƒ ğŸ¥°</div>
                    </div>
                </div>
                
                <div class="mood-diary">
                    <h3>ğŸ¾ å°ç‹—çš„å¿ƒæƒ…æ—¥è®°</h3>
                    <div id="treasure-diary">
                        <div class="diary-entry">
                            <div class="diary-date">ä»Šå¤©</div>
                            <div class="diary-content">ä»Šå¤©ä¸»äººé™ªæˆ‘ç©äº†å¥½ä¹…ï¼Œè¶…çº§å¼€å¿ƒï¼å¸Œæœ›æ˜å¤©ä¹Ÿèƒ½è¿™æ ·ï½</div>
                        </div>
                        <div class="diary-entry">
                            <div class="diary-date">æ˜¨å¤©</div>
                            <div class="diary-content">åƒäº†å¥½åƒçš„è‚‰è‚‰ï¼Œèººåœ¨çªé‡Œæ™’å¤ªé˜³ï¼Œå¹¸ç¦çš„ä¸€å¤©ï¼</div>
                        </div>
                        <div class="diary-entry">
                            <div class="diary-date">å‰å¤©</div>
                            <div class="diary-content">ä¸»äººç»™æˆ‘ä¹°äº†æ–°ç©å…·ï¼Œæ‘‡å°¾å·´æ‘‡åˆ°åœä¸ä¸‹æ¥ï¼</div>
                        </div>
                    </div>
                </div>
                
                <div class="interaction-buttons" style="margin-top: 15px;">
                    <button id="edit-treasure">ç¼–è¾‘ä¿¡æ¯ âœï¸</button>
                    <button id="add-diary">æ·»åŠ æ—¥è®° ğŸ“</button>
                </div>
            </div>
            
            <!-- æ–°å¢ç›¸å†Œå¡ç‰‡ -->
            <div class="card photo-album">
                <h2><i>ğŸ“·</i> æˆ‘ä»¬çš„å›å¿†ç›¸å†Œ</h2>
                <p>ä¸Šä¼ ä½ å’Œå°ç‹—çš„ç¾å¥½ç¬é—´ï½</p>
                <div class="photo-grid">
                    <div class="photo-item" id="photo-1"></div>
                    <div class="photo-item" id="photo-2"></div>
                    <div class="photo-item" id="photo-3"></div>
                    <div class="photo-item" id="photo-4"></div>
                    <div class="photo-item" id="photo-5"></div>
                    <div class="photo-item" id="photo-6"></div>
                </div>
                <input type="file" id="photo-upload" accept="image/*" style="display: none;">
                <button id="upload-btn" style="margin-top: 15px;">ä¸Šä¼ ç…§ç‰‡</button>
            </div>
            
            <!-- æ–°å¢æˆå°±ç³»ç»Ÿå¡ç‰‡ -->
            <div class="card achievement-card">
                <h2><i>ğŸ†</i> å°ç‹—æˆå°±ç³»ç»Ÿ</h2>
                <p>è§£é”å„ç§å¯çˆ±æˆå°±å§ï¼</p>
                <div class="badge-container">
                    <div class="badge" data-badge="food">
                        <i>ğŸ–</i>
                        <div class="badge-tooltip">ç¾é£Ÿå®¶ï¼šå–‚é£Ÿ10æ¬¡</div>
                    </div>
                    <div class="badge locked" data-badge="walk">
                        <i>ğŸš¶â€â™‚ï¸</i>
                        <div class="badge-tooltip">æ•£æ­¥è¾¾äººï¼šæ•£æ­¥5æ¬¡</div>
                    </div>
                    <div class="badge locked" data-badge="play">
                        <i>ğŸ¾</i>
                        <div class="badge-tooltip">æ¸¸æˆé«˜æ‰‹ï¼šç©3æ¬¡æ¸¸æˆ</div>
                    </div>
                    <div class="badge locked" data-badge="love">
                        <i>ğŸ’•</i>
                        <div class="badge-tooltip">çˆ±å¿ƒæ»¡æ»¡ï¼šäº’åŠ¨20æ¬¡</div>
                    </div>
                </div>
            </div>
            
            <!-- æ–°å¢éŸ³ä¹æ’­æ”¾å™¨å¡ç‰‡ -->
            <div class="card music-player">
                <h2><i>ğŸµ</i> å°ç‹—ä¸“å±BGM</h2>
                <p>æ’­æ”¾å°ç‹—å–œæ¬¢çš„éŸ³ä¹ï½</p>
                <div class="player-controls">
                    <button class="prev-btn"><i>â®</i></button>
                    <div class="play-btn">
                        <i>â–¶</i>
                    </div>
                    <button class="next-btn"><i>â­</i></button>
                </div>
                <div class="song-info">
                    <p>å½“å‰æ’­æ”¾: <span id="current-song">å°ç‹—åœ†èˆæ›²</span></p>
                </div>
                <audio id="bgm" loop>
                    <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
                </audio>
            </div>
            
            <!-- æ–°å¢è¯­éŸ³æ¶ˆæ¯å¡ç‰‡ -->
            <div class="card voice-message">
                <h2><i>ğŸ¤</i> å°ç‹—è¯­éŸ³æ¶ˆæ¯</h2>
                <p>ç‚¹å‡»å½•åˆ¶æŒ‰é’®ï¼Œå¬å°ç‹—è¯´è¯ï½</p>
                <div class="voice-btn" id="voice-btn">
                    <i>ğŸ¤</i>
                </div>
                <div class="voice-message-text" id="voice-message">
                    ç‚¹å‡»éº¦å…‹é£æŒ‰é’®å¬å°ç‹—è¯´è¯
                </div>
            </div>
            
            <!-- æ–°å¢ä»»åŠ¡ç³»ç»Ÿå¡ç‰‡ -->
            <div class="card task-card">
                <h2><i>ğŸ“‹</i> ä»Šæ—¥ä»»åŠ¡</h2>
                <div id="tasks-list">
                    <div class="task-item">
                        <input type="checkbox" class="task-checkbox" id="task-pet">
                        <label for="task-pet">æ‘¸æ‘¸å°ç‹— (+5å¿ƒæƒ…)</label>
                    </div>
                    <div class="task-item">
                        <input type="checkbox" class="task-checkbox" id="task-feed">
                        <label for="task-feed">å–‚é£Ÿä¸€æ¬¡ (+10å¿ƒæƒ…)</label>
                    </div>
                    <div class="task-item">
                        <input type="checkbox" class="task-checkbox" id="task-walk">
                        <label for="task-walk">å¸¦å°ç‹—æ•£æ­¥ (+15å¿ƒæƒ…)</label>
                    </div>
                </div>
                <div class="task-progress">
                    <div class="task-progress-fill" id="task-progress" style="width: 0%"></div>
                </div>
                <p>å®Œæˆæ‰€æœ‰ä»»åŠ¡è·å¾—é¢å¤–å¥–åŠ±ï¼</p>
            </div>
        </div>
        
        <!-- æ¶ˆæ¯åŒºåŸŸ -->
        <div class="message-area">
            <p id="dog-message">æ±ªæ±ªï¼ä»Šå¤©æ˜¯ä¸ªç¾å¥½çš„ä¸€å¤©ï¼Œæƒ³å’Œä½ ä¸€èµ·ç©ï¼</p>
        </div>
        
        <footer>
            <p>æˆ‘ä»¬çš„èµ›åšç”µå­å°çª ğŸ’• | å°ç‹—æ°¸è¿œçˆ±ä½ </p>
        </footer>
    </div>

    <!-- äº’åŠ¨åé¦ˆå…ƒç´  -->
    <div class="interaction-feedback" id="feedback"></div>
    <div class="achievement-popup" id="achievement-popup"></div>
    <div class="floating-hearts" id="floating-hearts"></div>

    <script>
        // å°ç‹—çŠ¶æ€
        const dog = {
            mood: 80,
            hunger: 80,
            energy: 90,
            name: "å°å¯çˆ±",
            nickname: "æ’’å¨‡å°èƒ½æ‰‹",
            favoritePerson: "ä½ ",
            todayMood: "è¶…çº§å¼€å¿ƒ ğŸ¥°"
        };
        
        // æˆå°±ç³»ç»Ÿ
        const badges = {
            food: { count: 0, required: 10 },
            walk: { count: 0, required: 5 },
            play: { count: 0, required: 3 },
            love: { count: 0, required: 20 }
        };
        
        // ä»»åŠ¡ç³»ç»Ÿ
        const tasks = [
            { id: 'pet', name: 'æ‘¸æ‘¸å°ç‹—', completed: false, reward: 5 },
            { id: 'feed', name: 'å–‚é£Ÿä¸€æ¬¡', completed: false, reward: 10 },
            { id: 'walk', name: 'å¸¦å°ç‹—æ•£æ­¥', completed: false, reward: 15 }
        ];
        
        // è·å–DOMå…ƒç´ 
        const moodElement = document.getElementById('mood');
        const hungerElement = document.getElementById('hunger');
        const dogMessage = document.getElementById('dog-message');
        const feedingMessage = document.getElementById('feeding-message');
        const feedbackElement = document.getElementById('feedback');
        const achievementPopup = document.getElementById('achievement-popup');
        const floatingHearts = document.getElementById('floating-hearts');
        
        // åˆå§‹åŒ–äº’åŠ¨ç³»ç»Ÿ
        initInteractionSystem();
        
        function initInteractionSystem() {
            setupChoiceButtons();
            setupDogInteractions();
            setupFeedingSystem();
            setupGameSystem();
            setupDiarySystem();
            setupWeatherSystem();
            setupTreasureCard();
            setupPhotoAlbum();
            setupAchievementSystem();
            setupMusicPlayer();
            setupVoiceMessage();
            setupTaskSystem();
            loadGameState();
        }
        
        // é€‰æ‹©æŒ‰é’®äº’åŠ¨é€»è¾‘
        function setupChoiceButtons() {
            document.getElementById('yes-btn').addEventListener('click', function() {
                showModal('æ­å–œä½ ï¼è·å¾—äº†ä¸»äººï¼ˆ*ï¼¾-ï¼¾*ï¼‰', 'success');
            });
            
            document.getElementById('no-btn').addEventListener('click', function() {
                showModal('ä¸å†ä»”ç»†æƒ³æƒ³äº†å˜›ï¼Œç¡®å®šå˜›', 'warning');
                
                setTimeout(() => {
                    showDoubleYesModal();
                }, 3000);
            });
        }
        
        // æ˜¾ç¤ºæ¨¡æ€æ¡†å‡½æ•°
        function showModal(message, type = 'normal') {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>${message}</h3>
                    <button class="choice-btn" onclick="this.parentElement.parentElement.remove()">ç¡®å®š</button>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // æ˜¾ç¤ºåŒYESæ¨¡æ€æ¡†
        function showDoubleYesModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>ä¸ç®¡äº†ï¼Œåæ­£ä½ æ˜¯æˆ‘çš„å°ç‹—äº†(ã€‚ãƒ»Ï‰ãƒ»ã€‚)</h3>
                    <div class="modal-buttons">
                        <button class="choice-btn" style="background: #06d6a0;" onclick="this.parentElement.parentElement.parentElement.remove(); showFinalMessage()">YES</button>
                        <button class="choice-btn" style="background: #06d6a0;" onclick="this.parentElement.parentElement.parentElement.remove(); showFinalMessage()">YES</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // æ˜¾ç¤ºæœ€ç»ˆæ¶ˆæ¯
        function showFinalMessage() {
            setTimeout(() => {
                showModal('ä¸ç®¡äº†ï¼Œåæ­£ä½ æ˜¯æˆ‘çš„å°ç‹—äº†(ã€‚ãƒ»Ï‰ãƒ»ã€‚)', 'final');
            }, 500);
        }
        
        // å°ç‹—äº’åŠ¨åŠŸèƒ½
        function setupDogInteractions() {
            // æ‘¸æ‘¸å°ç‹—
            document.getElementById('pet-btn').addEventListener('click', function() {
                enhancedPet();
            });
            
            // å¸¦å°ç‹—æ•£æ­¥
            document.getElementById('walk-btn').addEventListener('click', function() {
                enhancedWalk();
            });
            
            // å’Œå°ç‹—ç©è€
            document.getElementById('play-btn').addEventListener('click', function() {
                enhancedPlay();
            });
        }
        
        // å¢å¼ºçš„æ‘¸æ‘¸åŠŸèƒ½
        function enhancedPet() {
            const btn = document.getElementById('pet-btn');
            const dogElement = document.querySelector('.pixel-dog');
            
            // æŒ‰é’®åŠ¨ç”»
            btn.classList.add('pulse');
            setTimeout(() => btn.classList.remove('pulse'), 500);
            
            // å°ç‹—åŠ¨ç”»
            dogElement.classList.add('bounce');
            setTimeout(() => dogElement.classList.remove('bounce'), 600);
            
            // çŠ¶æ€æ›´æ–°
            dog.mood = Math.min(100, dog.mood + 10);
            updateDogStatus();
            
            // åé¦ˆæ•ˆæœ
            showFeedback('ğŸ¾ å°ç‹—å¼€å¿ƒåœ°æ‘‡å°¾å·´ï¼å¿ƒæƒ…+10', 'success');
            createHearts(btn.offsetLeft + btn.offsetWidth/2, btn.offsetTop, 5);
            
            // æˆå°±æ£€æŸ¥
            checkAchievement('love', 'çˆ±å¿ƒå¤§å¸ˆ');
            
            // å®Œæˆä»»åŠ¡
            completeTask('pet');
        }
        
        // å¢å¼ºçš„æ•£æ­¥åŠŸèƒ½
        function enhancedWalk() {
            if (dog.energy >= 20) {
                const walkBtn = document.getElementById('walk-btn');
                const dogElement = document.querySelector('.pixel-dog');
                
                // æ•£æ­¥åŠ¨ç”»
                walkBtn.classList.add('pulse');
                setTimeout(() => walkBtn.classList.remove('pulse'), 500);
                
                // å°ç‹—ç§»åŠ¨åŠ¨ç”»
                dogElement.style.transition = 'transform 2s ease-in-out';
                dogElement.style.transform = 'translateX(50px)';
                
                setTimeout(() => {
                    dogElement.style.transform = 'translateX(-50px)';
                }, 1000);
                
                setTimeout(() => {
                    dogElement.style.transform = 'translateX(0)';
                }, 2000);
                
                // çŠ¶æ€æ›´æ–°
                dog.mood = Math.min(100, dog.mood + 15);
                dog.energy = Math.max(0, dog.energy - 20);
                dog.hunger = Math.max(0, dog.hunger - 10);
                
                updateDogStatus();
                showFeedback('ğŸš¶â€â™‚ï¸ æ•£æ­¥çœŸå¼€å¿ƒï¼å¿ƒæƒ…+15ï¼Œèƒ½é‡-20', 'success');
                checkAchievement('walk', 'æ•£æ­¥è¾¾äºº');
                
                // å®Œæˆä»»åŠ¡
                completeTask('walk');
            } else {
                showFeedback('ğŸ˜´ å°ç‹—å¤ªç´¯äº†ï¼Œéœ€è¦ä¼‘æ¯...', 'warning');
            }
        }
        
        // å¢å¼ºçš„æ¸¸æˆåŠŸèƒ½
        function enhancedPlay() {
            if (dog.energy >= 15) {
                const playBtn = document.getElementById('play-btn');
                const dogElement = document.querySelector('.pixel-dog');
                
                // æ¸¸æˆåŠ¨ç”»åºåˆ—
                playBtn.classList.add('pulse');
                dogElement.classList.add('bounce');
                
                setTimeout(() => {
                    playBtn.classList.remove('pulse');
                    dogElement.classList.remove('bounce');
                }, 600);
                
                // çŠ¶æ€æ›´æ–°
                dog.mood = Math.min(100, dog.mood + 20);
                dog.energy = Math.max(0, dog.energy - 15);
                
                updateDogStatus();
                showFeedback('ğŸ¾ ç©å¾—å¥½å¼€å¿ƒï¼å¿ƒæƒ…+20ï¼Œèƒ½é‡-15', 'success');
                checkAchievement('play', 'æ¸¸æˆé«˜æ‰‹');
                
                // éšæœºæ¸¸æˆæ•ˆæœ
                if (Math.random() > 0.7) {
                    setTimeout(() => {
                        showFeedback('ğŸ¯ å°ç‹—æ¥ä½äº†çƒï¼é¢å¤–å¿ƒæƒ…+5', 'success');
                        dog.mood = Math.min(100, dog.mood + 5);
                        updateDogStatus();
                    }, 1000);
                }
            } else {
                showFeedback('ğŸ’¤ å°ç‹—éœ€è¦ä¼‘æ¯ä¸€ä¸‹å†ç©...', 'warning');
            }
        }
        
        // å–‚é£Ÿç³»ç»Ÿ
        function setupFeedingSystem() {
            const foodItems = document.querySelectorAll('.food-item');
            foodItems.forEach(item => {
                item.addEventListener('click', function() {
                    const foodType = this.getAttribute('data-food');
                    let message = "";
                    
                    switch(foodType) {
                        case 'bone':
                            dog.hunger = Math.min(100, dog.hunger + 15);
                            message = "ğŸ¦´ å•ƒéª¨å¤´çœŸå¼€å¿ƒï¼é¥±è…¹åº¦+15";
                            break;
                        case 'meat':
                            dog.hunger = Math.min(100, dog.hunger + 25);
                            message = "ğŸ– è‚‰è‚‰çœŸå¥½åƒï¼é¥±è…¹åº¦+25";
                            break;
                        case 'fish':
                            dog.hunger = Math.min(100, dog.hunger + 20);
                            dog.mood = Math.min(100, dog.mood + 5);
                            message = "ğŸŸ é±¼è‚‰ç¾å‘³ï¼é¥±è…¹åº¦+20ï¼Œå¿ƒæƒ…+5";
                            break;
                        case 'carrot':
                            dog.hunger = Math.min(100, dog.hunger + 10);
                            message = "ğŸ¥• èƒ¡èåœå¥åº·ï¼é¥±è…¹åº¦+10";
                            break;
                    }
                    
                    feedingMessage.textContent = message;
                    updateDogStatus();
                    
                    // æ·»åŠ åŠ¨ç”»æ•ˆæœ
                    this.classList.add('pulse');
                    setTimeout(() => {
                        this.classList.remove('pulse');
                    }, 300);
                    
                    // æˆå°±æ£€æŸ¥
                    checkAchievement('food', 'ç¾é£Ÿå®¶');
                    
                    // å®Œæˆä»»åŠ¡
                    completeTask('feed');
                });
            });
        }
        
        // æ¸¸æˆç³»ç»Ÿ
        function setupGameSystem() {
            document.getElementById('start-game').addEventListener('click', function() {
                const gameInstruction = document.getElementById('game-instruction');
                const gameStats = document.getElementById('game-stats');
                const scoreElement = document.getElementById('score');
                const timeElement = document.getElementById('time');
                
                gameInstruction.textContent = "æ¸¸æˆè¿›è¡Œä¸­ï¼ç‚¹å‡»å‡ºç°çš„çƒï¼";
                gameStats.style.display = 'block';
                this.style.display = 'none';
                
                let score = 0;
                let timeLeft = 30;
                
                scoreElement.textContent = score;
                timeElement.textContent = timeLeft;
                
                const gameInterval = setInterval(() => {
                    timeLeft--;
                    timeElement.textContent = timeLeft;
                    
                    if (timeLeft <= 0) {
                        clearInterval(gameInterval);
                        gameInstruction.textContent = `æ¸¸æˆç»“æŸï¼ä½ æ¥ä½äº† ${score} ä¸ªçƒï¼`;
                        this.style.display = 'block';
                        this.textContent = "å†ç©ä¸€æ¬¡";
                        
                        // æ ¹æ®æ¸¸æˆç»“æœæ›´æ–°å°ç‹—çŠ¶æ€
                        if (score >= 10) {
                            dog.mood = Math.min(100, dog.mood + 15);
                            showFeedback("æ¸¸æˆç©å¾—çœŸå¼€å¿ƒï¼å¿ƒæƒ…+15", 'success');
                        } else if (score >= 5) {
                            dog.mood = Math.min(100, dog.mood + 10);
                            showFeedback("æ¸¸æˆå¾ˆæœ‰è¶£ï¼å¿ƒæƒ…+10", 'success');
                        } else {
                            dog.mood = Math.min(100, dog.mood + 5);
                            showFeedback("æ¸¸æˆæŒºå¥½ç©çš„ï¼å¿ƒæƒ…+5", 'success');
                        }
                        updateDogStatus();
                    }
                }, 1000);
            });
        }
        
        // æ—¥è®°ç³»ç»Ÿ
        function setupDiarySystem() {
            document.getElementById('save-diary').addEventListener('click', function() {
                const diaryEntry = document.getElementById('diary-entry').value;
                if (diaryEntry.trim() !== "") {
                    const now = new Date();
                    const dateString = now.toLocaleDateString() + " " + now.toLocaleTimeString();
                    
                    const diaryHistory = document.getElementById('diary-history');
                    diaryHistory.innerHTML = `<p><strong>${dateString}:</strong> ${diaryEntry}</p>` + diaryHistory.innerHTML;
                    
                    document.getElementById('diary-entry').value = "";
                    showFeedback("æ—¥è®°å·²ä¿å­˜ï¼", 'success');
                }
            });
        }
        
        // å¤©æ°”ç³»ç»Ÿ
        function setupWeatherSystem() {
            document.getElementById('update-weather').addEventListener('click', function() {
                const weatherConditions = ["æ™´æœ—", "å¤šäº‘", "å°é›¨", "å¤§é£", "æ¸©æš–"];
                const temperatures = [22, 24, 20, 19, 25, 23];
                const moodIndices = [95, 90, 85, 80, 92, 88];
                
                const randomCondition = weatherConditions[Math.floor(Math.random() * weatherConditions.length)];
                const randomTemp = temperatures[Math.floor(Math.random() * temperatures.length)];
                const randomMood = moodIndices[Math.floor(Math.random() * moodIndices.length)];
                
                document.getElementById('weather-condition').textContent = randomCondition;
                document.getElementById('temperature').textContent = `${randomTemp}Â°C`;
                document.getElementById('mood-index').textContent = `${randomMood}/100`;
                
                // æ›´æ–°å¤©æ°”å›¾æ ‡
                const weatherIcon = document.querySelector('.weather-icon');
                if (randomCondition === "æ™´æœ—") {
                    weatherIcon.textContent = "â˜€ï¸";
                } else if (randomCondition === "å¤šäº‘") {
                    weatherIcon.textContent = "â›…";
                } else if (randomCondition === "å°é›¨") {
                    weatherIcon.textContent = "ğŸŒ§ï¸";
                } else if (randomCondition === "å¤§é£") {
                    weatherIcon.textContent = "ğŸ’¨";
                } else {
                    weatherIcon.textContent = "ğŸŒ¤ï¸";
                }
                
                showFeedback("å¤©æ°”å·²æ›´æ–°ï¼", 'success');
            });
        }
        
        // å®è—å¡åŠŸèƒ½
        function setupTreasureCard() {
            // ç¼–è¾‘ä¿¡æ¯åŠŸèƒ½
            document.getElementById('edit-treasure').addEventListener('click', function() {
                showEditModal();
            });
            
            // æ·»åŠ æ—¥è®°åŠŸèƒ½
            document.getElementById('add-diary').addEventListener('click', function() {
                showAddDiaryModal();
            });
        }
        
        // æ˜¾ç¤ºç¼–è¾‘ä¿¡æ¯æ¨¡æ€æ¡†
        function showEditModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>ç¼–è¾‘å°ç‹—ä¿¡æ¯ âœï¸</h3>
                    <div style="text-align: left; margin: 15px 0;">
                        <label>å°ç‹—åå­—:</label>
                        <input type="text" id="edit-dog-name" value="${dog.name}" style="width: 100%; padding: 8px; margin: 5px 0; border-radius: 5px; border: 2px solid #ffd700;">
                        
                        <label>æ’’å¨‡ç§°å·:</label>
                        <input type="text" id="edit-dog-nickname" value="${dog.nickname}" style="width: 100%; padding: 8px; margin: 5px 0; border-radius: 5px; border: 2px solid #ffd700;">
                        
                        <label>æœ€å–œæ¬¢çš„äºº:</label>
                        <input type="text" id="edit-favorite-person" value="${dog.favoritePerson}" style="width: 100%; padding: 8px; margin: 5px 0; border-radius: 5px; border: 2px solid #ffd700;">
                        
                        <label>ä»Šæ—¥å¿ƒæƒ…:</label>
                        <select id="edit-today-mood" style="width: 100%; padding: 8px; margin: 5px 0; border-radius: 5px; border: 2px solid #ffd700;">
                            <option value="è¶…çº§å¼€å¿ƒ ğŸ¥°" ${dog.todayMood === "è¶…çº§å¼€å¿ƒ ğŸ¥°" ? "selected" : ""}>è¶…çº§å¼€å¿ƒ ğŸ¥°</option>
                            <option value="å¼€å¿ƒ ğŸ˜Š" ${dog.todayMood === "å¼€å¿ƒ ğŸ˜Š" ? "selected" : ""}>å¼€å¿ƒ ğŸ˜Š</option>
                            <option value="ä¸€èˆ¬ ğŸ™‚" ${dog.todayMood === "ä¸€èˆ¬ ğŸ™‚" ? "selected" : ""}>ä¸€èˆ¬ ğŸ™‚</option>
                            <option value="æœ‰ç‚¹ä½è½ ğŸ˜" ${dog.todayMood === "æœ‰ç‚¹ä½è½ ğŸ˜" ? "selected" : ""}>æœ‰ç‚¹ä½è½ ğŸ˜</option>
                            <option value="ä¸å¼€å¿ƒ ğŸ˜”" ${dog.todayMood === "ä¸å¼€å¿ƒ ğŸ˜”" ? "selected" : ""}>ä¸å¼€å¿ƒ ğŸ˜”</option>
                        </select>
                    </div>
                    <div class="modal-buttons">
                        <button class="choice-btn" style="background: #06d6a0;" onclick="saveDogInfo()">ä¿å­˜</button>
                        <button class="choice-btn" onclick="this.parentElement.parentElement.parentElement.remove()">å–æ¶ˆ</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // ä¿å­˜å°ç‹—ä¿¡æ¯
        function saveDogInfo() {
            dog.name = document.getElementById('edit-dog-name').value;
            dog.nickname = document.getElementById('edit-dog-nickname').value;
            dog.favoritePerson = document.getElementById('edit-favorite-person').value;
            dog.todayMood = document.getElementById('edit-today-mood').value;
            
            document.getElementById('dog-name').textContent = dog.name;
            document.getElementById('dog-nickname').textContent = dog.nickname;
            document.getElementById('favorite-person').textContent = dog.favoritePerson;
            document.getElementById('today-mood').textContent = dog.todayMood;
            
            document.querySelector('.modal').remove();
            showFeedback("å°ç‹—ä¿¡æ¯å·²æ›´æ–°ï¼", 'success');
        }
        
        // æ˜¾ç¤ºæ·»åŠ æ—¥è®°æ¨¡æ€æ¡†
        function showAddDiaryModal() {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.innerHTML = `
                <div class="modal-content">
                    <h3>æ·»åŠ å°ç‹—æ—¥è®° ğŸ“</h3>
                    <textarea id="new-diary-content" placeholder="è®°å½•å°ç‹—ä»Šå¤©çš„å¿ƒæƒ…å’Œæ´»åŠ¨..." style="width: 100%; height: 100px; padding: 10px; border-radius: 5px; border: 2px solid #ffd700; margin: 10px 0;"></textarea>
                    <div class="modal-buttons">
                        <button class="choice-btn" style="background: #06d6a0;" onclick="saveDiary()">ä¿å­˜æ—¥è®°</button>
                        <button class="choice-btn" onclick="this.parentElement.parentElement.parentElement.remove()">å–æ¶ˆ</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        // ä¿å­˜æ—¥è®°
        function saveDiary() {
            const diaryContent = document.getElementById('new-diary-content').value;
            if (diaryContent.trim() !== "") {
                const now = new Date();
                const dateString = now.toLocaleDateString();
                
                const diaryEntry = document.createElement('div');
                diaryEntry.className = 'diary-entry';
                diaryEntry.innerHTML = `
                    <div class="diary-date">ä»Šå¤©</div>
                    <div class="diary-content">${diaryContent}</div>
                `;
                
                const treasureDiary = document.getElementById('treasure-diary');
                treasureDiary.insertBefore(diaryEntry, treasureDiary.firstChild);
                
                document.querySelector('.modal').remove();
                showFeedback("æ—¥è®°å·²æ·»åŠ åˆ°å®è—å¡ï¼", 'success');
            }
        }
        
        // ç›¸å†ŒåŠŸèƒ½
        function setupPhotoAlbum() {
            const photoUpload = document.getElementById('photo-upload');
            const uploadBtn = document.getElementById('upload-btn');
            
            uploadBtn.addEventListener('click', function() {
                photoUpload.click();
            });
            
            photoUpload.addEventListener('change', function(e) {
                const files = e.target.files;
                if (files.length > 0) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        // æ‰¾åˆ°ç¬¬ä¸€ä¸ªç©ºçš„ç›¸å†Œæ ¼å­
                        const emptyPhotoItem = document.querySelector('.photo-item:not(.has-image)');
                        if (emptyPhotoItem) {
                            emptyPhotoItem.classList.add('has-image');
                            emptyPhotoItem.innerHTML = `<img src="${event.target.result}" alt="ä¸Šä¼ çš„ç…§ç‰‡">`;
                            showFeedback("ç…§ç‰‡ä¸Šä¼ æˆåŠŸï¼", 'success');
                        } else {
                            showFeedback("ç›¸å†Œå·²æ»¡ï¼Œæ— æ³•ä¸Šä¼ æ›´å¤šç…§ç‰‡", 'warning');
                        }
                    };
                    reader.readAsDataURL(files[0]);
                }
            });
        }
        
        // æˆå°±ç³»ç»Ÿ
        function setupAchievementSystem() {
            // åˆå§‹åŒ–æˆå°±å¾½ç« 
            updateAchievementDisplay();
        }
        
        // éŸ³ä¹æ’­æ”¾å™¨
        function setupMusicPlayer() {
            const playBtn = document.querySelector('.play-btn');
            const bgm = document.getElementById('bgm');
            let isPlaying = false;
            
            playBtn.addEventListener('click', function() {
                if (isPlaying) {
                    bgm.pause();
                    playBtn.innerHTML = '<i>â–¶</i>';
                    showFeedback("éŸ³ä¹å·²æš‚åœ", 'success');
                } else {
                    bgm.play();
                    playBtn.innerHTML = '<i>â¸</i>';
                    showFeedback("æ­£åœ¨æ’­æ”¾: å°ç‹—åœ†èˆæ›²", 'success');
                }
                isPlaying = !isPlaying;
            });
        }
        
        // è¯­éŸ³æ¶ˆæ¯
        function setupVoiceMessage() {
            const voiceBtn = document.getElementById('voice-btn');
            const voiceMessage = document.getElementById('voice-message');
            const dogVoices = [
                "æ±ªæ±ªï¼æˆ‘å¥½æƒ³ä½ ï¼",
                "æ‘‡å°¾å·´ï½ä»Šå¤©ç©å¾—å¼€å¿ƒå—ï¼Ÿ",
                "å‘œå‘œ...æƒ³å‡ºå»æ•£æ­¥...",
                "æ±ªæ±ªï¼æˆ‘æœ€å–œæ¬¢ä½ äº†ï¼",
                "èœ·ç¼©åœ¨çªé‡Œå¥½èˆ’æœå‘€ï½"
            ];
            
            voiceBtn.addEventListener('click', function() {
                const randomIndex = Math.floor(Math.random() * dogVoices.length);
                voiceMessage.textContent = dogVoices[randomIndex];
                
                // æ·»åŠ åŠ¨ç”»æ•ˆæœ
                voiceBtn.style.animation = 'none';
                setTimeout(() => {
                    voiceBtn.style.animation = 'pulse 2s infinite';
                }, 10);
            });
        }
        
        // ä»»åŠ¡ç³»ç»Ÿ
        function setupTaskSystem() {
            // åˆå§‹åŒ–ä»»åŠ¡æ˜¾ç¤º
            updateTaskDisplay();
        }
        
        // å®Œæˆä»»åŠ¡
        function completeTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task && !task.completed) {
                task.completed = true;
                dog.mood += task.reward;
                showFeedback(`âœ… å®Œæˆä»»åŠ¡ï¼å¿ƒæƒ…+${task.reward}`, 'success');
                updateTaskDisplay();
                
                // æ£€æŸ¥æ˜¯å¦å®Œæˆæ‰€æœ‰ä»»åŠ¡
                const allCompleted = tasks.every(t => t.completed);
                if (allCompleted) {
                    showAchievement('ä»»åŠ¡å¤§å¸ˆ', 'å®Œæˆæ‰€æœ‰ä»Šæ—¥ä»»åŠ¡ï¼');
                }
            }
        }
        
        // æ›´æ–°ä»»åŠ¡æ˜¾ç¤º
        function updateTaskDisplay() {
            const tasksList = document.getElementById('tasks-list');
            const completedCount = tasks.filter(t => t.completed).length;
            const progress = (completedCount / tasks.length) * 100;
            
            tasksList.innerHTML = tasks.map(task => `
                <div class="task-item">
                    <input type="checkbox" class="task-checkbox" id="task-${task.id}" ${task.completed ? "checked" : ""}>
                    <label for="task-${task.id}">${task.name} (+${task.reward}å¿ƒæƒ…)</label>
                </div>
            `).join('');
            
            document.getElementById('task-progress').style.width = progress + '%';
        }
        
        // æ›´æ–°å°ç‹—çŠ¶æ€æ˜¾ç¤º
        function updateDogStatus() {
            // æ›´æ–°å¿ƒæƒ…æ˜¾ç¤º
            if (dog.mood >= 80) {
                moodElement.textContent = "å¼€å¿ƒ ğŸ˜Š";
            } else if (dog.mood >= 60) {
                moodElement.textContent = "ä¸€èˆ¬ ğŸ™‚";
            } else if (dog.mood >= 40) {
                moodElement.textContent = "æœ‰ç‚¹ä½è½ ğŸ˜";
            } else {
                moodElement.textContent = "ä¸å¼€å¿ƒ ğŸ˜”";
            }
            
            // æ›´æ–°é¥±è…¹åº¦æ˜¾ç¤º
            hungerElement.textContent = `${dog.hunger}%`;
            
            // éšæœºå°ç‹—æ¶ˆæ¯
            const messages = [
                "æ±ªæ±ªï¼ä»Šå¤©æ˜¯ä¸ªç¾å¥½çš„ä¸€å¤©ï¼Œæƒ³å’Œä½ ä¸€èµ·ç©ï¼",
                "æ‘‡å°¾å·´ï½æœ‰ä»€ä¹ˆå¥½åƒçš„å—ï¼Ÿ",
                "æ±ªæ±ªï¼æˆ‘æƒ³å‡ºå»æ•£æ­¥ï¼",
                "èœ·ç¼©åœ¨çªé‡Œå¥½èˆ’æœå‘€ï½",
                "æ±ªæ±ªï¼ä½ æ˜¯æˆ‘æœ€å–œæ¬¢çš„äººï¼"
            ];
            
            if (dog.mood < 40) {
                dogMessage.textContent = "å‘œå‘œ...æˆ‘æœ‰ç‚¹ä¸å¼€å¿ƒ...";
            } else if (dog.hunger < 40) {
                dogMessage.textContent = "æ±ªæ±ªï¼æˆ‘é¥¿äº†ï¼Œæƒ³åƒä¸œè¥¿ï¼";
            } else {
                const randomIndex = Math.floor(Math.random() * messages.length);
                dogMessage.textContent = messages[randomIndex];
            }
        }
        
        // æ˜¾ç¤ºäº’åŠ¨åé¦ˆ
        function showFeedback(message, type = 'normal') {
            feedbackElement.textContent = message;
            feedbackElement.style.display = 'block';
            
            // æ ¹æ®ç±»å‹è®¾ç½®ä¸åŒé¢œè‰²
            const colors = {
                normal: '#ff6b9d',
                success: '#06d6a0',
                warning: '#ffd166',
                error: '#ef476f'
            };
            
            feedbackElement.style.background = colors[type] || colors.normal;
            
            setTimeout(() => {
                feedbackElement.style.display = 'none';
            }, 1500);
        }
        
        // æ˜¾ç¤ºæˆå°±å¼¹çª—
        function showAchievement(title, description) {
            achievementPopup.innerHTML = `
                <div style="text-align: center;">
                    <div style="font-size: 2rem; margin-bottom: 5px;">ğŸ‰</div>
                    <div style="font-weight: bold; color: #ff6b9d;">${title}</div>
                    <div style="font-size: 0.9rem; color: #5a4a6a;">${description}</div>
                </div>
            `;
            achievementPopup.style.display = 'block';
            
            setTimeout(() => {
                achievementPopup.style.display = 'none';
            }, 3000);
        }
        
        // åˆ›å»ºæ¼‚æµ®çˆ±å¿ƒ
        function createHearts(x, y, count = 3) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.className = 'heart';
                    heart.innerHTML = 'ğŸ’•';
                    heart.style.left = (x + Math.random() * 50 - 25) + 'px';
                    heart.style.top = y + 'px';
                    heart.style.fontSize = (15 + Math.random() * 15) + 'px';
                    
                    floatingHearts.appendChild(heart);
                    
                    setTimeout(() => {
                        heart.remove();
                    }, 2000);
                }, i * 200);
            }
        }
        
        // æˆå°±æ£€æŸ¥
        function checkAchievement(type, title) {
            badges[type].count++;
            
            if (badges[type].count === badges[type].required) {
                const descriptions = {
                    food: 'æˆåŠŸå–‚é£Ÿ10æ¬¡ï¼çœŸæ˜¯ä¸ªè´´å¿ƒçš„ä¸»äººï½',
                    walk: 'å¸¦å°ç‹—æ•£æ­¥5æ¬¡ï¼è¿åŠ¨å¥åº·ä¸¤ä¸è¯¯ï½',
                    play: 'ç©æ¸¸æˆ3æ¬¡ï¼å’Œå°ç‹—å»ºç«‹äº†æ·±åšæ„Ÿæƒ…ï½',
                    love: 'äº’åŠ¨20æ¬¡ï¼ä½ ä»¬æ˜¯æœ€å¥½çš„ä¼™ä¼´ï½'
                };
                
                showAchievement(title, descriptions[type]);
                document.querySelector(`.badge[data-badge="${type}"]`).classList.remove('locked');
            }
        }
        
        // æ›´æ–°æˆå°±æ˜¾ç¤º
        function updateAchievementDisplay() {
            const badgeContainer = document.querySelector('.badge-container');
            badgeContainer.innerHTML = '';
            
            for (const [type, data] of Object.entries(badges)) {
                const badge = document.createElement('div');
                badge.className = `badge ${data.count >= data.required ? '' : 'locked'}`;
                badge.setAttribute('data-badge', type);
                
                let icon = '';
                switch(type) {
                    case 'food': icon = 'ğŸ–'; break;
                    case 'walk': icon = 'ğŸš¶â€â™‚ï¸'; break;
                    case 'play': icon = 'ğŸ¾'; break;
                    case 'love': icon = 'ğŸ’•'; break;
                }
                
                badge.innerHTML = `
                    <i>${icon}</i>
                    <div class="badge-tooltip">${type === 'food' ? 'ç¾é£Ÿå®¶ï¼šå–‚é£Ÿ10æ¬¡' : 
                                              type === 'walk' ? 'æ•£æ­¥è¾¾äººï¼šæ•£æ­¥5æ¬¡' : 
                                              type === 'play' ? 'æ¸¸æˆé«˜æ‰‹ï¼šç©3æ¬¡æ¸¸æˆ' : 
                                              'çˆ±å¿ƒæ»¡æ»¡ï¼šäº’åŠ¨20æ¬¡'}</div>
                `;
                
                badgeContainer.appendChild(badge);
            }
        }
        
        // ä¿å­˜æ¸¸æˆçŠ¶æ€
        function saveGameState() {
            const gameState = {
                dog: dog,
                badges: badges,
                tasks: tasks,
                lastPlayed: new Date().toISOString()
            };
            localStorage.setItem('cyberDogGame', JSON.stringify(gameState));
        }
        
        // åŠ è½½æ¸¸æˆçŠ¶æ€
        function loadGameState() {
            const saved = localStorage.getItem('cyberDogGame');
            if (saved) {
                const gameState = JSON.parse(saved);
                Object.assign(dog, gameState.dog);
                Object.assign(badges, gameState.badges);
                Object.assign(tasks, gameState.tasks);
                updateDogStatus();
                updateAchievementDisplay();
                updateTaskDisplay();
                
                // æ˜¾ç¤ºæ¬¢è¿å›æ¥æ¶ˆæ¯
                const lastPlayed = new Date(gameState.lastPlayed);
                const now = new Date();
                const hoursDiff = (now - lastPlayed) / (1000 * 60 * 60);
                
                if (hoursDiff > 1) {
                    showFeedback(`ğŸ¾ æ¬¢è¿å›æ¥ï¼å°ç‹—æƒ³ä½  ${Math.floor(hoursDiff)} å°æ—¶äº†ï½`, 'success');
                }
            }
        }
        
        // å®šæœŸæ›´æ–°å°ç‹—çŠ¶æ€ï¼ˆæ¨¡æ‹Ÿæ—¶é—´æµé€ï¼‰
        setInterval(() => {
            dog.mood = Math.max(0, dog.mood - 1);
            dog.hunger = Math.max(0, dog.hunger - 2);
            dog.energy = Math.min(100, dog.energy + 5);
            updateDogStatus();
            
            // è‡ªåŠ¨ä¿å­˜
            saveGameState();
        }, 30000); // æ¯30ç§’æ›´æ–°ä¸€æ¬¡

        // æ³¨å†ŒService Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker æ³¨å†ŒæˆåŠŸ: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker æ³¨å†Œå¤±è´¥: ', err);
                    });
            });
        }
        
        // æ·»åŠ å®‰è£…æç¤º
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            const installPrompt = e;
            
            // æ˜¾ç¤ºå®‰è£…æŒ‰é’®
            const installButton = document.createElement('button');
            installButton.textContent = 'å®‰è£…åº”ç”¨';
            installButton.style.position = 'fixed';
            installButton.style.bottom = '20px';
            installButton.style.right = '20px';
            installButton.style.zIndex = '1000';
            installButton.style.background = '#ff6b9d';
            installButton.style.color = 'white';
            installButton.style.padding = '10px 15px';
            installButton.style.borderRadius = '20px';
            installButton.style.border = 'none';
            installButton.style.boxShadow = '0 2px 10px rgba(0,0,0,0.2)';
            
            installButton.addEventListener('click', () => {
                installPrompt.prompt();
                installPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('ç”¨æˆ·æ¥å—äº†å®‰è£…æç¤º');
                    } else {
                        console.log('ç”¨æˆ·æ‹’ç»äº†å®‰è£…æç¤º');
                    }
                    installButton.remove();
                });
            });
            
            document.body.appendChild(installButton);
            
            // 5ç§’åè‡ªåŠ¨éšè—
            setTimeout(() => {
                installButton.remove();
            }, 5000);
        });
    </script>
</body>
</html>
